webpackJsonp([22],{Logp:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=l("vLgD");var s=l("CV50"),n=l("STSY"),r=l("iVC1"),i=l("GXH0"),a=l.n(i),d=(l("DmJO"),{components:{Treeselect:a.a},props:{isAdd:{type:Boolean,required:!0},dicts:{type:Array,required:!0}},data:function(){var e=this;return{dialog:!1,loading:!1,form:{username:"",email:"",enabled:"false",roles:[],job:{id:""},dept:{id:""},phone:null},roleIds:[],roles:[],depts:[],deptId:null,jobId:null,jobs:[],style:"width: 184px",level:3,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,trigger:"blur",validator:function(t,l,o){l?e.isvalidPhone(l)?o():o(new Error("请输入正确的11位手机号码")):o(new Error("请输入电话号码"))}}],enabled:[{required:!0,message:"状态不能为空",trigger:"blur"}]}}},created:function(){navigator.userAgent.indexOf("Chrome")>=0?this.style="width: 184px":this.style="width: 172px"},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.form.dept.id=this.deptId,this.form.job.id=this.jobId,this.$refs.form.validate(function(t){if(!t)return!1;if(null===e.deptId||void 0===e.deptId)e.$message({message:"部门不能为空",type:"warning"});else if(null===e.jobId)e.$message({message:"岗位不能为空",type:"warning"});else if(0===e.roleIds.length)e.$message({message:"角色不能为空",type:"warning"});else{e.loading=!0,e.form.roles=[];var l=e;e.roleIds.forEach(function(e,t){var o={id:e};l.form.roles.push(o)}),e.isAdd?e.doAdd():e.doEdit()}})},doAdd:function(){var e,t=this;(e=this.form,Object(o.a)({url:"api/users",method:"post",data:e})).then(function(e){t.resetForm(),t.$notify({title:"添加成功",message:"默认密码：123456",type:"success",duration:2500}),t.loading=!1,t.$parent.init()}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})},doEdit:function(){var e,t=this;(e=this.form,Object(o.a)({url:"api/users",method:"put",data:e})).then(function(e){t.resetForm(),t.$notify({title:"修改成功",type:"success",duration:2500}),t.loading=!1,t.$parent.init()}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.deptId=null,this.jobId=null,this.roleIds=[],this.form={username:"",email:"",enabled:"false",roles:[],job:{id:""},dept:{id:""},phone:null}},getRoles:function(){var e=this;Object(n.g)().then(function(t){e.roles=t}).catch(function(e){console.log(e.response.data.message)})},getJobs:function(e){var t=this;Object(r.d)(e).then(function(e){t.jobs=e.content}).catch(function(e){console.log(e.response.data.message)})},getDepts:function(){var e=this;Object(s.d)({enabled:!0}).then(function(t){e.depts=t.content})},isvalidPhone:function(e){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(e)},selectFun:function(e,t){this.getJobs(e.id)},getRoleLevel:function(){var e=this;Object(n.h)().then(function(t){e.level=t.level}).catch(function(e){console.log(e.response.data.message)})}}}),u={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-dialog",{attrs:{visible:e.dialog,title:e.isAdd?"新增用户":"编辑用户","append-to-body":"",width:"570px"},on:{"update:visible":function(t){e.dialog=t}}},[l("el-form",{ref:"form",attrs:{inline:!0,model:e.form,rules:e.rules,size:"small","label-width":"66px"}},[l("el-form-item",{attrs:{label:"用户名",prop:"username"}},[l("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"状态",prop:"enabled"}},e._l(e.dicts,function(t){return l("el-radio",{key:t.id,attrs:{label:t.value},model:{value:e.form.enabled,callback:function(t){e.$set(e.form,"enabled",t)},expression:"form.enabled"}},[e._v(e._s(t.label))])}),1),e._v(" "),l("el-form-item",{attrs:{label:"电话",prop:"phone"}},[l("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",e._n(t))},expression:"form.phone"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[l("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"部门"}},[l("treeselect",{style:e.style,attrs:{options:e.depts,placeholder:"选择部门"},on:{select:e.selectFun},model:{value:e.deptId,callback:function(t){e.deptId=t},expression:"deptId"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"岗位"}},[l("el-select",{style:e.style,attrs:{placeholder:"请先选择部门"},model:{value:e.jobId,callback:function(t){e.jobId=t},expression:"jobId"}},e._l(e.jobs,function(e,t){return l("el-option",{key:e.name+t,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"角色"}},[l("el-select",{staticStyle:{width:"450px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.roleIds,callback:function(t){e.roleIds=t},expression:"roleIds"}},e._l(e.roles,function(t,o){return l("el-option",{key:t.name+o,attrs:{disabled:1!==e.level&&t.level<=e.level,label:t.name,value:t.id}})}),1)],1)],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),l("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)},staticRenderFns:[]};var c=l("VU/8")(d,u,!1,function(e){l("pbGG")},"data-v-7627d0a1",null);t.default=c.exports},pbGG:function(e,t){}});