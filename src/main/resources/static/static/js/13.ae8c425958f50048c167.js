webpackJsonp([13],{DrqK:function(e,t){},Y1ug:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s("Foau"),a=s("R2SV"),o=s("Ks07"),d=s("gN++"),l=s("GXH0"),r=s.n(l),n=(s("DmJO"),s("Lf8l")),u=s("5j4I"),c=s("TIfe"),p={mixins:[o.a],components:{Treeselect:r.a,progressNum:n.default,progressReg:u.default},data:function(){return{data:[],rowid:"",prcessParentId:"",states:"",clikeName:"",activeName:"tow",detail:0,exportLoading:!1,downLoading:!1,centerDialogVisible:!1,exceldialog:!1,excelLoading:!1,fullscreenLoading:!1,dataLoad:!1,addpeople:!1,deletepeople:!1,editpeople:!0,activeNames:["1"],unitName:"",loading:!1,addPeopleData:[],editPeopleData:[],deletePeopleData:[],peopleName:"",editDialog:!1,addDuty:!1,addDutyData:[],deleteDuty:!1,deleteDutyData:[],editDuty:!1,deleteRank:!1,addRank:!1,addRankData:[],deleteRankData:[],editRank:!1,deleteEducation:!1,addEducation:!1,addEducationData:[],deleteEducationData:[],editEducation:!1,deleteReward:!1,addReward:!1,addRewardData:[],deleteRewardData:[],editReward:!1,deleteAssessment:!1,addAssessment:!1,addAssessmentData:[],deleteAssessmentData:[],editAssessment:!1,deleteUser:!1,addUser:!1,addUserData:[],deleteUserData:[],digestData:[],isDigest:!1,editUser:!1,unitId:"",value:"",flag:"",dataId:"",category:{},admin:!1,notAdmin:!1,hasChild:!1,approvalData:[],processData:[],isProcess:!1,isApproval:!1,isRank:!1,isPeople:!1,isEducation:!1,isReward:!1,isAssessment:!1,processId:"",isDuty:!1,approvalUnitName:"",peopleNameStrs:"",isUser:!1,zhishuvisible:!1,primary1:"success",primary2:"success",primary3:"success",primary4:"success",primary5:"success",form:{parentId:this.unitId,flag:"职数"},units:[],downDialogVisible:!1}},created:function(){this.getUnitTrees(),this.sqlVisible()},methods:{beforeInit:function(){this.url="api/data/notEndProcess";var e=this.query,t=e.name,s=e.approveFlag;return this.params={page:this.page,size:this.size,unitName:t,approveFlag:s,states:"未审批",flag:this.flag},!0},sqlVisible:function(){var e=this.$route.query.params;"zhiji"===e?(this.primary1="primary",this.activeName="one"):"reg"===e?(this.primary2="primary",this.activeName="tow"):"approvaled"===e&&(this.primary5="primary",this.activeName="tow")},getRowClass:function(e){e.row,e.column,e.rowIndex,e.columnIndex},rowClick:function(e,t,s){this.rowid=e.id,this.prcessParentId=e.parentId,this.clikeName=e.unitName,this.states=e.states,this.approvalUnitName=e.approvalUnitName,this.peopleNameStrs=e.people},handleChange:function(e){console.log(e)},agreeImportData:function(){var e=this,t={dataId:this.dataId};this.exportLoading=!0,Object(i.a)(t).then(function(t){e.centerDialogVisible=!1,e.exportLoading=!1,e.$notify({title:"上行成功！",type:"success",duration:2500})}).catch(function(t){e.exportLoading=!1,console.log(t.response.msg)})},agreeImportDataDialog:function(){this.centerDialogVisible=!0},getUnitTrees:function(){var e=this;Object(d.l)({enabled:"0"}).then(function(t){e.units=t.result,e.form.parentId=t.result[0].id,e.unitName=t.result[0].name,e.unitId=t.result[0].id,"1"===t.result[0].hasChild?e.hasChild=!0:e.hasChild=!1,"1"===t.ext.roles?(e.admin=!0,e.activeName="tow"):(e.notAdmin=!0,e.activeName="one")})},exportUpstreamData:function(){this.downDialogVisible=!0},selectDepart:function(e){console.log("selectDepart",e),this.unitName=e.name},peopleEditWin:function(e){this.editDialog=!0,this.peopleName=e.name,this.value=e.value},formatter:function(e,t,s,i){if(null!=e[t.property])return Object(a.a)(e[t.property])},importUpstreamData:function(e){this.exceldialog=!0,this.flag=e},importData:function(){this.exceldialog=!0,this.flag="0"},exportExcleMode:function(){var e=this;Object(i.e)().then(function(t){e.exportLoading=!1,e.$notify({title:"备份成功",type:"success",duration:2500})}).catch(function(t){e.exportLoading=!1,console.log(t.response.data.message)})},uploadSuccess:function(e,t){if(200!=e.code)return this.excelLoading=!1,this.fullscreenLoading=!1,this.$notify({title:"数据导入失败"+e.msg,type:"error",duration:25e3}),t;this.$notify({title:"数据导入成功"+e.msg,type:"success",duration:25e3}),this.fullscreenLoading=!1,this.excelLoading=!1,this.exceldialog=!1,"1"===this.flag&&(this.dataId=e.result.dataId,this.dataLoad=!0,void 0!=e.result.peopleAdd?(this.addPeopleData=e.result.peopleAdd,this.addpeople=!0,this.isPeople=!0):this.addpeople=!1,void 0!=e.result.peopleDelete?(this.deletePeopleData=e.result.peopleDelete,this.deletepeople=!0,this.isPeople=!0):this.deletepeople=!1,void 0!=e.result.peopleEdit?(this.editPeopleData=e.result.peopleEdit,this.editpeople=!0,this.isPeople=!0):this.editpeople=!1,void 0!=e.result.peopleAdd&&void 0!=e.result.peopleEdit&&void 0!=e.result.peopleDelete&&(this.isPeople=!1),void 0!=e.result.dutyAdd?(this.addDutyData=e.result.dutyAdd,this.addDuty=!0,this.isDuty=!0):this.addDuty=!1,void 0!=e.result.dutyDelete?(this.deleteDutyData=e.result.dutyDelete,this.deleteDuty=!0,this.isDuty=!0):this.deleteDuty=!1,void 0!=e.result.dutyEdit?(this.editDutyData=e.result.dutyEdit,this.editDuty=!0,this.isDuty=!0):this.editDuty=!1,void 0!=e.result.dutyAdd&&void 0!=e.result.dutyDelete&&void 0!=e.result.dutyEdit&&(this.isDuty=!1),void 0!=e.result.rankAdd?(this.addRankData=e.result.rankAdd,this.addRank=!0,this.isRank=!0):this.addRank=!1,void 0!=e.result.rankDelete?(this.deleteRankData=e.result.rankDelete,this.deleteRank=!0,this.isRank=!0):this.deleteRank=!1,void 0!=e.result.rankEdit?(this.editRankData=e.result.rankEdit,this.editRank=!0,this.isRank=!0):this.editRank=!1,void 0!=e.result.rankAdd&&void 0!=e.result.rankDelete&&void 0!=e.result.rankEdit&&(this.isRank=!1),void 0!=e.result.educationAdd?(this.addEducationData=e.result.educationAdd,this.addEducation=!0,this.isEducation=!0):this.addEducation=!1,void 0!=e.result.educationDelete?(this.deleteEducationData=e.result.educationDelete,this.deleteEducation=!0,this.isEducation=!0):this.deleteEducation=!1,void 0!=e.result.educationEdit?(this.editEducationData=e.result.educationEdit,this.editEducation=!0,this.isEducation=!0):this.editEducation=!1,void 0!=e.result.educationAdd&&void 0!=e.result.educationDelete&&void 0!=e.result.educationEdit&&(this.isEducation=!1),void 0!=e.result.rewardAdd?(this.addRewardData=e.result.rewardAdd,this.addReward=!0,this.isReward=!0):this.addReward=!1,void 0!=e.result.rewardDelete?(this.deleteRewardData=e.result.rewardDelete,this.deleteReward=!0,this.isReward=!0):this.deleteReward=!1,void 0!=e.result.rewardEdit?(this.editRewardData=e.result.rewardEdit,this.editReward=!0,this.isReward=!0):this.editReward=!1,void 0!=e.result.rewardAdd&&void 0!=e.result.rewardDelete&&void 0!=e.result.rewardEdit&&(this.isReward=!1),void 0!=e.result.assessmentAdd?(this.addAssessmentData=e.result.assessmentAdd,this.addAssessment=!0,this.isAssessment=!0):this.addAssessment=!1,void 0!=e.result.assessmentDelete?(this.deleteAssessmentData=e.result.assessmentDelete,this.deleteAssessment=!0,this.isAssessment=!0):this.deleteAssessment=!1,void 0!=e.result.assessmentEdit?(this.editAssessmentData=e.result.assessmentEdit,this.editAssessment=!0,this.isAssessment=!0):this.editAssessment=!1,void 0!=e.result.assessmentAdd&&void 0!=e.result.assessmentDelete&&void 0!=e.result.assessmentEdit&&(this.isAssessment=!1),void 0!=e.result.userAdd?(this.addUserData=e.result.userAdd,this.addUser=!0,this.isUser=!0):this.addUser=!1,void 0!=e.result.userDelete?(this.deleteUserData=e.result.userDelete,this.deleteUser=!0,this.isUser=!0):this.deleteUser=!1,void 0!=e.result.userEdit?(this.editUserData=e.result.userEdit,this.editUser=!0,this.isUser=!0):this.editUser=!1,void 0!=e.result.userAdd&&void 0!=e.result.userDelete&&void 0!=e.result.userEdit&&(this.isUser=!1),void 0!=e.result.aprovalList?(this.approvalData=e.result.aprovalList,this.isApproval=!0):this.isApproval=!1,void 0!=e.result.digests?(this.digestData=e.result.digests,this.isDigest=!0):this.isDigest=!1,void 0!=e.result.processList?(this.processData=e.result.processList,this.isProcess=!0):this.isProcess=!1)},handleError:function(e,t){var s=JSON.parse(e.message);this.$notify({title:s.message,type:"error",duration:2500})},beforeAvatarUpload:function(e){if(this.unitId=Object(c.a)("unitId"),this.category.unitId=this.unitId,console.log(this.category),"1"===this.flag||"2"===this.flag){var t="json"===e.name.split(".")[1];return t||this.$message.error("上传w文件只能是 json格式!"),t}var s="sql"===e.name.split(".")[1];return s||this.$message.error("上传w文件只能是 sql格式!"),s},handleExceed:function(e){this.$message.warning("当前限制选择 1 个文件，请删除后继续上传")},submitUpload:function(){this.excelLoading=!0,this.unitId=Object(c.a)("unitId");var e=localStorage.getItem("childUnit"),t=Object(c.a)("userCookie");this.category.unitId=this.unitId,this.category.childUnit=e,this.category.userId=t,console.log(this.category),this.$refs.upload.submit()},uploadUrl:function(){return"1"===this.flag?"http://localhost:8085/api/data/importUpstreamData":"http://localhost:8085/api/data/importDownDatabase"},handleRemove:function(e){console.log(e)},handlePreview:function(e){console.log(e)},upstreamData:function(e){this.init(),this.editDialog=!0,this.flag=e},doSubmit:function(){if(""==this.rowid||void 0===this.rowid)this.$notify({title:"请先选择审批表！",type:"error",duration:2500});else if(null!=this.prcessParentId&&void 0!=this.prcessParentId&&""!=this.prcessParentId)this.$notify({title:"请先选择父级审批表！",type:"error",duration:2500});else if(this.unitName!=this.clikeName&&"未审批"===this.states)this.$notify({title:"未审批不可导出！",type:"error",duration:2500});else{var e=new Date,t=e.getFullYear(),s=e.getMonth()+1,i=e.getDate(),a=e.getHours(),o=e.getMinutes(),d=t+""+s+i,l="备案",r="";void 0!=this.approvalUnitName&&"初审"===this.states&&(r=this.approvalUnitName+"初审"),"1"===this.flag&&(l="职数");var n={unitId:this.unitId,dataType:"上行",flag:l,processId:this.rowid};this.exportLoading=!0;var u=this,c=this.clikeName+"_"+l+r+"上报数据"+d+"-"+a+":"+o+".json";this.$axios({method:"post",url:"http://localhost:8085/api/data/upstreamData",params:n,contentType:"application/x-www-form-urlencoded",responseType:"blob"}).then(function(e){console.log(e);var t=document.createElement("a"),s=new Blob([e.data],{type:"application/vnd.ms-json"});t.style.display="none",t.href=URL.createObjectURL(s),t.setAttribute("download",c),document.body.appendChild(t),t.click(),document.body.removeChild(t),u.exportLoading=!1,u.editDialog=!1}).catch(function(e){console.log(e),u.editDialog=!1})}}}},h={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"sqlDiv",staticStyle:{width:"100%","text-align":"center"}},[s("el-row",[e.notAdmin?s("el-button",{attrs:{type:e.primary1,icon:"el-icon-download",round:""},on:{click:function(t){return e.upstreamData("1")}}},[e._v("导出职数申报数据")]):e._e(),e._v(" "),e.notAdmin?s("el-button",{attrs:{type:e.primary2,loading:e.exportLoading,icon:"el-icon-download",round:""},on:{click:function(t){return e.upstreamData("2")}}},[e._v("导出备案及其他上报数据")]):e._e(),e._v(" "),e.notAdmin?s("el-button",{attrs:{type:e.primary5,loading:e.exportLoading,round:""},on:{click:function(t){return e.importUpstreamData("2")}}},[e._v("导入审批后数据"),s("i",{staticClass:"el-icon-upload el-icon--right"})]):e._e()],1),e._v(" "),s("div",{staticStyle:{width:"100%","border-color":"#b5b8c8",float:"left","text-align":"center"}},[s("el-dialog",{attrs:{visible:e.exceldialog,"append-to-body":"",width:"500px"},on:{"update:visible":function(t){e.exceldialog=t}}},[s("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"",name:"excelFile",action:e.uploadUrl(),loading:e.excelLoading,limit:1,data:e.category,"on-exceed":e.handleExceed,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-error":e.handleError,"on-success":e.uploadSuccess,"auto-upload":!1,"before-upload":e.beforeAvatarUpload}},[s("i",{staticClass:"el-icon-upload"}),e._v(" "),s("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),s("em",[e._v("点击上传")])]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("一次只能上传一个文件，仅限sql、json格式")])]),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen.lock",value:e.fullscreenLoading,expression:"fullscreenLoading",modifiers:{fullscreen:!0,lock:!0}}],attrs:{type:"primary"},on:{click:e.submitUpload}},[e._v("导入")])],1)],1)],1),e._v(" "),s("div",[s("el-dialog",{attrs:{"append-to-body":!0,width:"95%",title:"审批数据导出",visible:e.editDialog},on:{"update:visible":function(t){e.editDialog=t}}},[s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","font-size":"10px"},attrs:{"header-cell-style":{"text-align":"center",background:"#ADD8E6",color:"#030303"},"cell-style":{padding:"0px"},data:e.data,size:"small","row-key":"id","element-loading-text":"请稍后","default-expand-all":"","highlight-current-row":"","element-loading-spinner":"el-icon-loading",border:""},on:{"row-click":e.rowClick}},[s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"unitName",label:"单位名称"}}),e._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"processFlag",label:"审批表类型"}}),e._v(" "),s("el-table-column",{attrs:{sortable:"","show-overflow-tooltip":!0,prop:"createTime",label:"创建日期"}}),e._v(" "),s("el-table-column",{attrs:{sortable:"","show-overflow-tooltip":!0,prop:"processTime",label:"审批日期"}}),e._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"approvalUnitName",label:"审批单位"}}),e._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"people",label:"审批人"}}),e._v(" "),s("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"states",label:"状态"}})],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"text"},on:{click:function(t){e.editDialog=!1}}},[e._v("取消")]),e._v(" "),s("el-button",{attrs:{loading:e.exportLoading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)],1)],1)},staticRenderFns:[]};var m=s("VU/8")(p,h,!1,function(e){s("DrqK")},"data-v-bb3cb4da",null);t.default=m.exports}});