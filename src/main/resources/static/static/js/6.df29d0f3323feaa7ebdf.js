webpackJsonp([6,22],{"1F+2":function(e,t){},Logp:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l("vLgD");var a=l("CV50"),n=l("STSY"),s=l("iVC1"),o=l("GXH0"),r=l.n(o),d=(l("DmJO"),{components:{Treeselect:r.a},props:{isAdd:{type:Boolean,required:!0},dicts:{type:Array,required:!0}},data:function(){var e=this;return{dialog:!1,loading:!1,form:{username:"",email:"",enabled:"false",roles:[],job:{id:""},dept:{id:""},phone:null},roleIds:[],roles:[],depts:[],deptId:null,jobId:null,jobs:[],style:"width: 184px",level:3,rules:{username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],phone:[{required:!0,trigger:"blur",validator:function(t,l,i){l?e.isvalidPhone(l)?i():i(new Error("请输入正确的11位手机号码")):i(new Error("请输入电话号码"))}}],enabled:[{required:!0,message:"状态不能为空",trigger:"blur"}]}}},created:function(){navigator.userAgent.indexOf("Chrome")>=0?this.style="width: 184px":this.style="width: 172px"},methods:{cancel:function(){this.resetForm()},doSubmit:function(){var e=this;this.form.dept.id=this.deptId,this.form.job.id=this.jobId,this.$refs.form.validate(function(t){if(!t)return!1;if(null===e.deptId||void 0===e.deptId)e.$message({message:"部门不能为空",type:"warning"});else if(null===e.jobId)e.$message({message:"岗位不能为空",type:"warning"});else if(0===e.roleIds.length)e.$message({message:"角色不能为空",type:"warning"});else{e.loading=!0,e.form.roles=[];var l=e;e.roleIds.forEach(function(e,t){var i={id:e};l.form.roles.push(i)}),e.isAdd?e.doAdd():e.doEdit()}})},doAdd:function(){var e,t=this;(e=this.form,Object(i.a)({url:"api/users",method:"post",data:e})).then(function(e){t.resetForm(),t.$notify({title:"添加成功",message:"默认密码：123456",type:"success",duration:2500}),t.loading=!1,t.$parent.init()}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})},doEdit:function(){var e,t=this;(e=this.form,Object(i.a)({url:"api/users",method:"put",data:e})).then(function(e){t.resetForm(),t.$notify({title:"修改成功",type:"success",duration:2500}),t.loading=!1,t.$parent.init()}).catch(function(e){t.loading=!1,console.log(e.response.data.message)})},resetForm:function(){this.dialog=!1,this.$refs.form.resetFields(),this.deptId=null,this.jobId=null,this.roleIds=[],this.form={username:"",email:"",enabled:"false",roles:[],job:{id:""},dept:{id:""},phone:null}},getRoles:function(){var e=this;Object(n.g)().then(function(t){e.roles=t}).catch(function(e){console.log(e.response.data.message)})},getJobs:function(e){var t=this;Object(s.d)(e).then(function(e){t.jobs=e.content}).catch(function(e){console.log(e.response.data.message)})},getDepts:function(){var e=this;Object(a.d)({enabled:!0}).then(function(t){e.depts=t.content})},isvalidPhone:function(e){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(e)},selectFun:function(e,t){this.getJobs(e.id)},getRoleLevel:function(){var e=this;Object(n.h)().then(function(t){e.level=t.level}).catch(function(e){console.log(e.response.data.message)})}}}),c={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("el-dialog",{attrs:{visible:e.dialog,title:e.isAdd?"新增用户":"编辑用户","append-to-body":"",width:"570px"},on:{"update:visible":function(t){e.dialog=t}}},[l("el-form",{ref:"form",attrs:{inline:!0,model:e.form,rules:e.rules,size:"small","label-width":"66px"}},[l("el-form-item",{attrs:{label:"用户名",prop:"username"}},[l("el-input",{model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"状态",prop:"enabled"}},e._l(e.dicts,function(t){return l("el-radio",{key:t.id,attrs:{label:t.value},model:{value:e.form.enabled,callback:function(t){e.$set(e.form,"enabled",t)},expression:"form.enabled"}},[e._v(e._s(t.label))])}),1),e._v(" "),l("el-form-item",{attrs:{label:"电话",prop:"phone"}},[l("el-input",{model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",e._n(t))},expression:"form.phone"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"邮箱",prop:"email"}},[l("el-input",{model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"部门"}},[l("treeselect",{style:e.style,attrs:{options:e.depts,placeholder:"选择部门"},on:{select:e.selectFun},model:{value:e.deptId,callback:function(t){e.deptId=t},expression:"deptId"}})],1),e._v(" "),l("el-form-item",{attrs:{label:"岗位"}},[l("el-select",{style:e.style,attrs:{placeholder:"请先选择部门"},model:{value:e.jobId,callback:function(t){e.jobId=t},expression:"jobId"}},e._l(e.jobs,function(e,t){return l("el-option",{key:e.name+t,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),l("el-form-item",{staticStyle:{"margin-bottom":"0px"},attrs:{label:"角色"}},[l("el-select",{staticStyle:{width:"450px"},attrs:{multiple:"",placeholder:"请选择"},model:{value:e.roleIds,callback:function(t){e.roleIds=t},expression:"roleIds"}},e._l(e.roles,function(t,i){return l("el-option",{key:t.name+i,attrs:{disabled:1!==e.level&&t.level<=e.level,label:t.name,value:t.id}})}),1)],1)],1),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{attrs:{type:"text"},on:{click:e.cancel}},[e._v("取消")]),e._v(" "),l("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.doSubmit}},[e._v("确认")])],1)],1)},staticRenderFns:[]};var u=l("VU/8")(d,c,!1,function(e){l("pbGG")},"data-v-7627d0a1",null);t.default=u.exports},TwAS:function(e,t,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l("FAPO"),a=l("oGvx"),n=l("CV50"),s=l("Ks07"),o=l("mHAX"),r={components:{eForm:l("Logp").default},mixins:[s.a,o.a],data:function(){return{height:document.documentElement.clientHeight-180+"px;",isAdd:!1,delLoading:!1,deptName:"",depts:[],deptId:null,defaultProps:{children:"children",label:"label"},downloadLoading:!1,queryTypeOptions:[{key:"username",display_name:"用户名"},{key:"email",display_name:"邮箱"}],enabledTypeOptions:[{key:"true",display_name:"激活"},{key:"false",display_name:"锁定"}]}},created:function(){var e=this;this.$nextTick(function(){e.getDeptDatas()})},methods:{parseTime:a.a,checkPermission:i.a,getDeptDatas:function(){var e=this,t={id:"ID",sort:"desc",name:this.deptName};Object(n.d)(t).then(function(t){e.depts=t.result})},handleNodeClick:function(e){0===e.pid?this.deptId=null:this.deptId=e.id,this.init()},add:function(){this.isAdd=!0,this.$refs.form.getDepts(),this.$refs.form.getRoles(),this.$refs.form.getRoleLevel(),this.$refs.form.dialog=!0},edit:function(e){this.isAdd=!1;var t=this.$refs.form;t.getRoles(),t.getDepts(),t.getRoleLevel(),t.roleIds=[],t.form={id:e.id,username:e.username,phone:e.phone,email:e.email,enabled:e.enabled.toString(),roles:[],dept:{id:e.dept.id},job:{id:e.job.id}},e.roles.forEach(function(e,l){t.roleIds.push(e.id)}),t.deptId=e.dept.id,t.jobId=e.job.id,t.getJobs(t.deptId),t.dialog=!0}}},d={render:function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",[l("eForm",{ref:"form",attrs:{"is-add":e.isAdd,dicts:e.dicts}}),e._v(" "),l("el-row",{staticStyle:{"margin-left":"5px"},attrs:{gutter:20}},[l("el-col",{attrs:{xs:7,sm:6,md:4,lg:4,xl:4}},[l("div",{staticClass:"head-container",staticStyle:{"padding-top":"10px"}},[l("el-input",{staticClass:"filter-item",staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"输入部门名称搜索","prefix-icon":"el-icon-search"},on:{input:e.getDeptDatas},model:{value:e.deptName,callback:function(t){e.deptName=t},expression:"deptName"}})],1),e._v(" "),l("el-tree",{attrs:{data:e.depts,props:e.defaultProps,"expand-on-click-node":!1,"default-expand-all":""},on:{"node-click":e.handleNodeClick}})],1),e._v(" "),l("el-col",{attrs:{xs:17,sm:18,md:20,lg:20,xl:20}},[l("div",{staticClass:"head-container",staticStyle:{"padding-top":"10px"}},[l("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"输入关键字搜索"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.toQuery(t)}},model:{value:e.query.value,callback:function(t){e.$set(e.query,"value",t)},expression:"query.value"}}),e._v(" "),l("el-select",{staticClass:"filter-item",staticStyle:{width:"130px"},attrs:{clearable:"",placeholder:"类型"},model:{value:e.query.type,callback:function(t){e.$set(e.query,"type",t)},expression:"query.type"}},e._l(e.queryTypeOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})}),1),e._v(" "),l("el-select",{staticClass:"filter-item",staticStyle:{width:"90px"},attrs:{clearable:"",placeholder:"状态"},on:{change:e.toQuery},model:{value:e.query.enabled,callback:function(t){e.$set(e.query,"enabled",t)},expression:"query.enabled"}},e._l(e.enabledTypeOptions,function(e){return l("el-option",{key:e.key,attrs:{label:e.display_name,value:e.key}})}),1),e._v(" "),l("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"success",icon:"el-icon-search"},on:{click:e.toQuery}},[e._v("搜索")]),e._v(" "),l("div",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_CREATE"],expression:"['ADMIN','USER_ALL','USER_CREATE']"}],staticStyle:{display:"inline-block",margin:"0px 2px"}},[l("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新增")])],1),e._v(" "),l("div",{staticStyle:{display:"inline-block"}},[l("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN"],expression:"['ADMIN']"}],staticClass:"filter-item",attrs:{loading:e.downloadLoading,size:"mini",type:"warning",icon:"el-icon-download"}},[e._v("导出")])],1)],1),e._v(" "),l("el-table",{staticStyle:{width:"100%"},attrs:{data:e.data,size:"small"}},[l("el-table-column",{attrs:{prop:"username",label:"用户名"}}),e._v(" "),l("el-table-column",{attrs:{prop:"phone",label:"电话"}}),e._v(" "),l("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"email",label:"邮箱"}}),e._v(" "),l("el-table-column",{attrs:{label:"部门 / 岗位"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("div",[e._v(e._s(t.row.dept.name)+" / "+e._s(t.row.job.name))])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(e.dicts,function(i){return l("div",{key:i.id},[t.row.enabled.toString()===i.value?l("el-tag",{attrs:{type:t.row.enabled?"":"info"}},[e._v(e._s(i.label))]):e._e()],1)})}}])}),e._v(" "),l("el-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"createTime",label:"创建日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("span",[e._v(e._s(e.parseTime(t.row.createTime)))])]}}])}),e._v(" "),l("el-table-column",{attrs:{label:"操作",width:"125",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-button",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_EDIT"],expression:"['ADMIN','USER_ALL','USER_EDIT']"}],attrs:{size:"mini",type:"primary",icon:"el-icon-edit"},on:{click:function(l){return e.edit(t.row)}}}),e._v(" "),l("el-popover",{directives:[{name:"permission",rawName:"v-permission",value:["ADMIN","USER_ALL","USER_DELETE"],expression:"['ADMIN','USER_ALL','USER_DELETE']"}],ref:t.row.id,attrs:{placement:"top",width:"180"}},[l("p",[e._v("确定删除本条数据吗？")]),e._v(" "),l("div",{staticStyle:{"text-align":"right",margin:"0"}},[l("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(l){e.$refs[t.row.id].doClose()}}},[e._v("取消")]),e._v(" "),l("el-button",{attrs:{loading:e.delLoading,type:"primary",size:"mini"},on:{click:function(l){return e.subDelete(t.row.id)}}},[e._v("确定")])],1),e._v(" "),l("el-button",{attrs:{slot:"reference",type:"danger",icon:"el-icon-delete",size:"mini"},slot:"reference"})],1)]}}])}),e._v(" "),l("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{total:e.total,"current-page":e.page+1,layout:"total, prev, pager, next, sizes"},on:{"size-change":e.sizeChange,"current-change":e.pageChange}})],1)],1)],1)],1)},staticRenderFns:[]};var c=l("VU/8")(r,d,!1,function(e){l("1F+2")},"data-v-762bf335",null);t.default=c.exports},pbGG:function(e,t){}});