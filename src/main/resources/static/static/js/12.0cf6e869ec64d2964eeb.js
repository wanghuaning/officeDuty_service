webpackJsonp([12],{n5Pp:function(t,e){},pF3t:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=o("gN++"),n={data:function(){return{defaultProps:{children:"children",label:"label"},importInfodialog:!1,fileName:"",backupDialogVisible:!1,category:{},repeat:!1,exportLoading:!1,radio:!1,unitId:"",excelLoading:!1,unitIds:[],unitSelect:[],units:[],centerDialogVisible:!1,titles:"",flag:"",admin:!1,form:{unitName:""},importForm:{userAccount:"",userPassword:""},rules:{unitName:[{required:!0,message:"请选择单位！",trigger:"blur"}]}}},created:function(){this.getUnitTrees()},methods:{getUnitTrees:function(){var t=this,e={enabled:"0",childUnit:localStorage.getItem("childUnit")};Object(i.m)(e).then(function(e){t.units=e.result,t.unitId=e.result[0].id,"1"===e.ext.roles&&(t.admin=!0)}),Object(i.n)().then(function(e){t.unitSelect=e.result,t.unitName=e.result[0].name})},exportExcleMode:function(t){var e={flag:t};this.$axios({method:"post",url:"http://120.76.246.155:8085/api/unit/outExcelModel",params:e,contentType:"application/x-www-form-urlencoded",responseType:"blob"}).then(function(e){console.log(e);var o=document.createElement("a"),i=new Blob([e.data],{type:"application/vnd.ms-excel"});o.style.display="none",o.href=URL.createObjectURL(i),"rankAndDuty"===t?o.setAttribute("download","批量导入职务职级采集表.xls"):"unit"===t?o.setAttribute("download","单位信息采集表.xls"):"people"===t&&o.setAttribute("download","人员信息采集表.xlsx"),document.body.appendChild(o),o.click(),document.body.removeChild(o)}).catch(function(t){console.log(t)})},uploadSuccess:function(t,e){if(200!=t.code)return this.excelLoading=!1,this.$notify({title:"备份回复失败"+t.msg,type:"error",duration:25e3}),e;this.excelLoading=!1,this.$notify({title:"备份回复成功"+t.msg,type:"success",duration:25e3}),this.exceldialog=!1},handleError:function(t,e){var o=JSON.parse(t.message);this.$notify({title:o.message,type:"error",duration:2500})},beforeAvatarUpload:function(t){var e="json"===t.name.split(".")[1],o="json"===t.name.split(".")[1];return e||o||this.$message.error("上传w文件只能是 json格式!"),e||o},handleExceed:function(t){this.$message.warning("当前限制选择 1 个文件，请删除后继续上传")},submitUpload:function(){this.excelLoading=!0,this.category.loginUnitId=this.unitId,console.log(this.category),this.$refs.upload.submit(),this.importInfodialog=!1},uploadUrl:function(){return"http://120.76.246.155:8085/api/data/importBackDatabase"},handleRemove:function(t){console.log(t)},handlePreview:function(t){console.log(t)},backup:function(t){this.backupDialogVisible=!0},backUpData:function(){var t=this;this.exportLoading=!0,Object(i.b)().then(function(e){t.exportLoading=!1,t.$notify({title:"备份成功！",type:"success",duration:2500}),t.fileName=e.result,t.backupDialogVisible=!1}).catch(function(e){t.exportLoading=!1,console.log(e.response.msg),t.backupDialogVisible=!1})},exportBackUnitData:function(){this.form.unitName="",this.centerDialogVisible=!0},exportData:function(){var t=this;if(void 0!=this.form.unitName&&""!=this.form.unitName){var e=new Date,o=e.getFullYear(),i=e.getMonth()+1,n=e.getDate(),a=e.getHours(),l=e.getMinutes(),r=o+""+i+n,s=this.form.unitName+"_备份数据"+r+"-"+a+":"+l+".json";this.exportLoading=!0;var c={flag:"数据备份",unitName:this.form.unitName};this.$axios({method:"post",url:"http://120.76.246.155:8085/api/data/backUpUnitData",params:c,contentType:"application/x-www-form-urlencoded",responseType:"blob"}).then(function(e){console.log(e);var o=document.createElement("a"),i=new Blob([e.data],{type:"application/vnd.ms-json"});o.style.display="none",o.href=URL.createObjectURL(i),o.setAttribute("download",s),document.body.appendChild(o),o.click(),t.exportLoading=!1,t.centerDialogVisible=!1,document.body.removeChild(o)}).catch(function(e){console.log(e),t.exportLoading=!1,t.centerDialogVisible=!1})}else this.$notify({title:"请选择单位！",type:"error",duration:2500})},importBackUnitData:function(){this.importInfodialog=!0}}},a={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticStyle:{"margin-top":"10px"}},[o("fieldset",{staticStyle:{width:"98%","border-color":"#b5b8c8","text-align":"center"}},[t._m(0),t._v(" "),o("el-row",[o("el-button",{attrs:{type:"primary",icon:"el-icon-download"},on:{click:function(e){return t.exportExcleMode("unit")}}},[t._v("单位信息采集表")]),t._v(" "),o("el-button",{attrs:{type:"success",icon:"el-icon-download"},on:{click:function(e){return t.exportExcleMode("people")}}},[t._v("人员信息采集表")]),t._v(" "),o("el-button",{attrs:{type:"warning",icon:"el-icon-download"},on:{click:function(e){return t.exportExcleMode("rankAndDuty")}}},[t._v("批量导入职务职级采集表")])],1)],1),t._v(" "),t.admin?o("fieldset",{staticStyle:{width:"98%","border-color":"#b5b8c8","margin-top":"20px","text-align":"center"}},[t._m(1),t._v(" "),o("el-row",[o("el-button",{attrs:{type:"warning",round:""},on:{click:function(e){return t.backup()}}},[t._v("数据库备份")]),t._v(" "),o("span",[t._v("备份文件地址：C:\\RM\\file\\data\\"+t._s(t.fileName))])],1)],1):t._e(),t._v(" "),o("fieldset",{staticStyle:{width:"98%","border-color":"#b5b8c8","text-align":"center"}},[t._m(2),t._v(" "),o("el-row",[t.admin?o("el-button",{attrs:{type:"success",icon:"el-icon-download"},on:{click:function(e){return t.exportBackUnitData()}}},[t._v("单位数据备份")]):t._e(),t._v(" "),o("el-button",{attrs:{type:"info",icon:"el-icon-download"},on:{click:function(e){return t.importBackUnitData()}}},[t._v("导入备份数据")])],1)],1),t._v(" "),o("el-dialog",{staticStyle:{width:"100%","margin-left":"0px"},attrs:{visible:t.centerDialogVisible,title:t.titles,"append-to-body":""},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[o("el-form",{attrs:{model:t.form,rules:t.rules,size:"small","label-width":"140px"}},[o("el-form-item",{attrs:{label:"单位",prop:"unit"}},[o("el-select",{attrs:{filterable:"",placeholder:"请选择"},model:{value:t.form.unitName,callback:function(e){t.$set(t.form,"unitName",e)},expression:"form.unitName"}},t._l(t.unitSelect,function(t){return o("el-option",{key:t.value,ref:"slecte",refInFor:!0,attrs:{label:t.label,value:t.value}})}),1)],1)],1),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(e){t.centerDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),o("el-button",{attrs:{loading:t.exportLoading,type:"primary"},on:{click:t.exportData}},[t._v("确 定")])],1)],1),t._v(" "),o("el-dialog",{attrs:{visible:t.importInfodialog,"append-to-body":"",width:"500px"},on:{"update:visible":function(e){t.importInfodialog=e}}},[o("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{drag:"",action:t.uploadUrl(),data:t.category,loading:t.excelLoading,limit:1,"on-exceed":t.handleExceed,name:"excelFile","on-preview":t.handlePreview,"on-remove":t.handleRemove,"on-error":t.handleError,"on-success":t.uploadSuccess,"auto-upload":!1,"before-upload":t.beforeAvatarUpload}},[o("i",{staticClass:"el-icon-upload"}),t._v(" "),o("div",{staticClass:"el-upload__text"},[t._v("将文件拖到此处，或"),o("em",[t._v("点击上传")])]),t._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[t._v("一次只能上传一个文件，仅限Json格式")])]),t._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{loading:t.exportLoading,type:"primary"},on:{click:t.submitUpload}},[t._v("导入")])],1)],1),t._v(" "),o("el-dialog",{attrs:{title:"提示","append-to-body":!0,visible:t.backupDialogVisible,width:"30%",center:""},on:{"update:visible":function(e){t.backupDialogVisible=e}}},[o("span",[t._v("是否确认备份数据库！")]),t._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{type:"primary",loading:t.exportLoading},on:{click:t.backUpData}},[t._v("确 定")]),t._v(" "),o("el-button",{on:{click:function(e){t.backupDialogVisible=!1}}},[t._v("取 消")])],1)])],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("legend",{staticStyle:{"text-align":"center"}},[e("span",[this._v("采集表下载区")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("legend",{staticStyle:{"text-align":"center"}},[e("span",[this._v("数据管理")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("legend",{staticStyle:{"text-align":"center"}},[e("span",[this._v("单位数据备份")])])}]};var l=o("VU/8")(n,a,!1,function(t){o("n5Pp")},"data-v-dd2285b2",null);e.default=l.exports}});